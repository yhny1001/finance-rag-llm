# 断点续传功能使用指南

## 功能简介

断点续传功能允许系统在处理大量问题时，即使程序中断，也能从上次处理的位置继续执行，避免重新开始。这对于处理大规模数据集或遇到网络、系统不稳定等情况特别有用。

## 使用场景

- 处理大量问题时，需要暂停或中断处理
- 系统因错误或资源限制意外退出
- 需要分批次处理大量数据
- 想要在不同时间或不同设备上继续处理

## 基本使用

### 1. 自动断点续传

系统默认已启用断点续传功能，每当批量处理完成一个批次后，都会自动保存当前进度。

**运行测试时**:

```bash
python main.py
```

如果系统检测到之前有未完成的处理，会询问是否继续上次的处理:

```
🔄 检测到上次处理的断点
是否继续上次的处理? (y/n，默认y): 
```

- 输入 `y` 或直接按回车: 继续上次的处理
- 输入 `n`: 清除检查点，从头开始

### 2. 强制从头开始处理

如果想忽略之前的检查点，强制从头开始处理:

```bash
python main.py --no-resume
```

### 3. 查看当前检查点信息

```bash
python main.py --checkpoint-info
```

将显示如下信息:

```
==================================================
📊 检查点信息
==================================================
🕒 保存时间: 2023-05-30 14:30:45
🔖 会话ID: 20230530_143025
📈 进度: 50/100 (50.0%)
📦 批处理大小: 10
📝 已保存结果数: 50
```

### 4. 清除当前检查点

```bash
python main.py --checkpoint-clear
```

## 高级管理功能

系统提供了专门的检查点管理工具，用于更复杂的检查点管理操作:

```bash
python checkpoint_manager.py
```

不带参数运行会显示帮助信息和当前检查点状态(如果存在)。

### 常用命令:

```bash
# 显示检查点详情
python checkpoint_manager.py --info

# 清除当前检查点
python checkpoint_manager.py --clear

# 备份当前检查点
python checkpoint_manager.py --backup

# 使用自定义名称备份检查点
python checkpoint_manager.py --backup --backup-name my_checkpoint

# 列出所有备份
python checkpoint_manager.py --list-backups

# 从备份恢复
python checkpoint_manager.py --restore my_checkpoint
```

## 工作原理

1. **检查点保存内容**:
   - 当前处理进度
   - 已处理的结果数据
   - 批处理大小
   - 会话标识和时间戳

2. **存储位置**:
   - 检查点状态: `checkpoints/processing_status.json`
   - 检查点结果: `checkpoints/checkpoint_results.json`
   - 备份: `checkpoints/backups/`

3. **更新时机**:
   - 每个批次处理完成后
   - 发生异常或用户中断时
   - 完整处理完成后自动清除

## 安全措施

- 恢复前自动备份当前检查点
- 批次保存防止大范围数据丢失
- 异常处理保障检查点完整性

## 疑难解答

### 问题：系统没有询问是否继续上次处理

**解决方案**: 可能是检查点文件损坏或丢失，使用管理工具检查:

```bash
python checkpoint_manager.py --info
```

### 问题：恢复检查点后处理结果有误

**解决方案**: 尝试从备份恢复:

```bash
# 首先查看备份列表
python checkpoint_manager.py --list-backups

# 恢复特定备份
python checkpoint_manager.py --restore backup_name
```

### 问题：无法清除检查点

**解决方案**: 手动删除检查点文件:

```bash
# 删除检查点目录
rm -rf checkpoints/
```

## 注意事项

1. 断点续传功能依赖于文件系统，确保程序有足够的文件读写权限
2. 大型结果数据可能占用较多磁盘空间，定期清理旧备份
3. 当对代码逻辑进行大量修改后，旧的检查点可能不兼容，建议清除后重新开始

## 最佳实践

1. 对于大型处理任务，建议定期手动备份检查点
2. 保持合理的批处理大小，既能提高效率又能减少意外中断的损失
3. 处理完成后清理检查点，避免下次运行时使用过时数据
4. 备份重要的检查点，以便在需要时回退到特定处理阶段 